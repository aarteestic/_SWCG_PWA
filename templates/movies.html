<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shadow Wizard Reviews</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='ASSETS/WBESITE_ICON.ico') }}">
  <link rel="manifest" href="/manifest.json">
</head>

<style>
  #scrollableMovieTable {
    margin-left: auto;
    margin-right: auto; /*aligns the table in the middle */

    font-size: 18px;
    color: #e1e1e1;
    font-family: inherit;
    font-weight: 800;

    height:450px;
    overflow-y: scroll;
    scrollbar-color: coral #111;
    scroll-snap-align: center;
    scroll-margin: 10px;
    overflow-x: hidden;
  }

  #myInput {

    margin-left: 5%;
    margin-right: 5%; /*aligns the table in the middle */

    width: 80%; /* Full-width */


    font-size: 10px; /* Increase font-size */
    padding: 12px 20px 12px 40px; /* Add some padding */
    border: 1px solid #ddd; /* Add a grey border */
    margin-bottom: 12px; /* Add some space below the input */

  }

  .recordValue {
    float:left;
    height: 100px;
    padding-left: 10px;
    text-align: center;
  }

  #recordImage {
    height:300px;
    width: 200px;
    float:left;
  }

  #record {
    
    margin-left: auto;
    margin-right: auto; /*aligns the table in the middle */

    border:1px solid coral;
    background-color:#111;
    border-radius: 25px;

    height:300px;
    width: 80%;
    display:grid;
    grid-template-columns: 200px 50% auto;
    grid-template-rows: 100px 100px auto;
  }
</style>


<body>
  <div class="background-layer"></div>
  <nav>
    <div class="logo-container">
      <a href="/">
        <img src="{{ url_for('static', filename='ASSETS/NAV_IMG.png') }}" alt="Logo" class="navbar-logo" style="height:50px;width:50px;">
      </a>
    </div>
    <button onclick="navigateTo(1)">Home</button>
    <button onclick="navigateTo(2)">Movies</button>
    <button onclick="navigateTo(3)">Users</button>
    <button class="invisible" disabled></button>
    <button class="invisible" disabled></button>
    <button class="invisible" disabled></button>
    {% if login: %}
    <button onclick="sendUserToTheirPage()">{{ sessionUsername }}</button>
    <form action="/" class="logoutForm" method="post">
      <button type="submit" style="height:60px;">Logout</button>
    </form>
    {% else: %}
    <button onclick="navigateTo(5)">Register</button>
    <button onclick="navigateTo(6)">Login</button>
    {% endif %}
  </nav>


  <div class="carousel-section">
    <h2 class="carousel-title"><b>Movies</b></h2>
  </div>
<!--https://stackoverflow.com/questions/15321431/how-to-pass-a-list-from-python-by-jinja2-to-javascript/53952147#53952147-->
<!--a beautiful stackoverflow answer showcasing the power of jinja-->

<input type="text" id="myInput" onkeyup="search()" placeholder="Search for title.." style="border-radius:25px;"> <!--Allows for searching of movies-->

<div class="dropdown">
  <button style="color:#111;">Genre</button>
  <div class="filters">
    <br>
    <a><input class="filter" type="checkbox" value="COMEDY" id="COMEDY" onclick="filterGenre(this.value)">Comedy</a>
    <a><input class="filter" type="checkbox" value="ROMANCE" id="ROMANCE" onclick="filterGenre(this.value)">Romance</a>
    <a><input class="filter" type="checkbox" value="DRAMA" id="DRAMA" onclick="filterGenre(this.value)">Drama</a>
    <a><input class="filter" type="checkbox" value="ACTION" id="ACTION" onclick="filterGenre(this.value)">Action</a>
    <a><input class="filter" type="checkbox" value="HISTORY" id="HISTORY" onclick="filterGenre(this.value)">History</a>
    <a><input class="filter" type="checkbox" value="FANTASY" id="FANTASY" onclick="filterGenre(this.value)">Fantasy</a>
    <br>
    <br>
    <button onclick="resetFilters()" style="margin-left:10px;">RESET</button>
    <br>
    <br>
  </div>
</div>



  <div id="scrollableMovieTable">
{% for ti in movie %} <!--add images in the next update-->
  <div id="record" class="record">  <!--https://www.w3schools.com/css/css_grid_item.asp see this website for details on 'grid system'-->
    <div style="grid-column:1/span 1;grid-row:1/span 3" id="recordImage"><img src={{ ti[4] }} width=200px height=300px style="border-radius:25px;"></div> <!--thumbnail image-->
    <div style="grid-column:2/span 2;grid-row:1/span 1;width:50%;text-align: center;font-size: 22px;" class="recordValue" ><a  id="title" href="/movies/{{movie.index(ti)}}">{{ ti[0] }}</a></div>  <!--proof of concept for dynamically generated movie stuff-->
    <div style="grid-column:3/span 1;grid-row:1/span 1;width:250px;background-color: coral;"class="recordValue"><p style="color:hsl(0, 0%, 10%);">RATING:</p> {{ ti[2] }} out of 10</div>
    <div style="grid-column:2/span 2;grid-row:3/span 1;width:50%;" class="recordValue"><p style="color:coral;">GENRE/S:</p> {{ ti[3] }}</div> <!--genre-->
  
    <div style="grid-column:3/span 1;grid-row:2/span 2;width:250px;height:200px;background-color:coral;"class="recordValue"> <a id="title" href="/movies/{{movie.index(ti)}}" style="color:hsl(0, 0%, 10%);">TO MOVIE</a> </div> <!--ADD NICE SNAZZY LINK MAGIC-->
    
    <div style="grid-column:2/span 2;grid-row:2/span 1;width:50%;"class="recordValue"> <p style="color:coral;">DIRECTOR/S:</p> {{ ti[5] }} </div> <!--director(s)-->
    <div style="display:none;">True</div> <!--pseudo-boolean value for searching-->
  </div>
{% endfor %}
  </div>


<!--extra css/js-->
<style>


.dropdown {
  margin-left: 200px;
  margin-right: auto;
  padding-bottom: 10px;
  width: 70px;
  
}
.dropdown button {
  border: none;
  cursor: pointer;
  background-color: #fff;
  border-radius: 10px;
  font-size: 18px;
  font-family: inherit;
  font-weight: 800;
}



.dropdown a {
  display:block;
  text-decoration: none;
  padding:10 15px;
}

.dropdown .filters{
  display: none;
  position:absolute;
  min-width: 150px;
  background-color:#111;
  border: 1px solid coral;
}

.dropdown:hover .filters {
  display:block;
  border-radius: 10px;
}

.dropdown:hover button {
  background-color: coral;
  color:#fff;
}

.dropdown button:hover {
  color: #fff;
}

.dropdown button:after {
  content: "";
  pointer-events: none;
  bottom: -2px;
  left: 50%;
  position: absolute;
  width: 0;
  height: 2px;
  background-color: #fff;
  transition: width 400ms cubic-bezier(0.25, 0.8, 0.25, 1), left 400ms cubic-bezier(0.25, 0.8, 0.25, 1);
}

#title {
  position: relative; /* Required for pseudo-elements */
  color: coral; /* Default color */
  text-decoration: none; /* Removes default underline */
  transition: color 400ms cubic-bezier(0.25, 0.8, 0.25, 1); /* Smooth color transition */
}

#title::after {
  content: "";
  position: absolute;
  bottom: 0; /* Align underline to bottom */
  left: 0;
  width: 0; /* Start with no underline */
  height: 2px; /* Thickness of underline */
  background-color: #fff; /* Color of the underline */
  transition: width 400ms cubic-bezier(0.25, 0.8, 0.25, 1); /* Smooth underline transition */
}

#title:hover {
  color:coral; /* Change text color on hover */
}

#title:hover::after {
  width: 100%; /* Expand underline on hover */
}

.filters a {
  font-weight: bold;
  color: coral;
  padding: 0px 5px;
}

</style>

  <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
  <script>
    //add table stuff soon...
  function sendUserToTheirPage() { //sends user to their own page
    window.location.href = '/users/{{sessionUsername}}'
  }

  var genres = {
   "COMEDY": false,
   "ROMANCE": false,
   "DRAMA": false,
   "ACTION": false,
   "HISTORY": false,
   "FANTASY": false
  }

  function filterGenre(genre) { //from W3Schools https://www.w3schools.com/howto/howto_js_filter_table.asp
    // Declare variables
    var count, othercount, filter, table, tr, td, i, txtValue, button;
    count = 0;
    othercount = 0;
    filter = genre.toUpperCase(); // just in case!
    table = document.getElementById("scrollableMovieTable");
    tr = table.getElementsByClassName("record");
    button = document.getElementById(genre);
    // Loop through all table rows, and hide those who don't match the search query
    if (button.checked == true) {
      button.style.display = "none";
      genres[genre] = true;
      for (i = 0; i < tr.length; i++) {
        filter = genre.toUpperCase();
        td = tr[i].getElementsByTagName("div")[3];
        if (td) {
            txtValue = td.textContent || td.innerText;
            for (const[key, value] of Object.entries(genres)) {
              if (value == true) {
                count += 1;
                if (txtValue.toUpperCase().indexOf(key) > -1) {
                  othercount += 1;
                }
              }
            }
            if (othercount == count) {
              tr[i].style.display = "";
              tr[i].getElementsByTagName("div")[6].innerText = 'True';
            } else {
              tr[i].style.display = "none";
              tr[i].getElementsByTagName("div")[6].innerText = 'False';
              count = 0;
              othercount = 0;
            }
            count = 0;
            othercount = 0;

            
        }
      }
    }
    count = 0;
    othercount = 0;
    }

  function resetFilters() {
    var filter;
    filter = document.getElementsByClassName("filter");
    for (i=0; i < filter.length; i++) {
      a = filter[i];
      a.checked = false;
      a.style.display = "";
    }



    var table, tr, td, i, txtValue;
    table = document.getElementById("scrollableMovieTable");
    tr = table.getElementsByClassName("record");

    for (i = 0; i < tr.length; i++) {
      td = tr[i].getElementsByTagName("div")[1];
      
      if (td) {
          tr[i].style.display = "";
          tr[i].getElementsByTagName("div")[6].innerText = 'True'; //if check is True, then display
        }
      }
    
    genres['COMEDY'] = false;
    genres['ROMANCE'] = false;
    genres['DRAMA'] = false; //hard coded solution im gonna crash out 
    genres['ACTION'] = false;
    genres['HISTORY'] = false;
    genres['FANTASY'] = false;  
  }

  function search() { //from W3Schools https://www.w3schools.com/howto/howto_js_filter_table.asp
    // Declare variables
    var input, filter, table, tr, td, i, txtValue;
    input = document.getElementById("myInput");
    filter = input.value.toUpperCase();
    table = document.getElementById("scrollableMovieTable");
    tr = table.getElementsByClassName("record");

    // Loop through all table rows, and hide those who don't match the search query
    for (i = 0; i < tr.length; i++) {
      check = tr[i].getElementsByTagName("div")[6].textContent;
      td = tr[i].getElementsByTagName("div")[1];
      if (td && check == 'True') {
        txtValue = td.textContent || td.innerText;
        if (txtValue.toUpperCase().indexOf(filter) > -1) {
          tr[i].style.display = "";
        } else {
          tr[i].style.display = "none";
        }
      }
    }
  }
  </script>
  
</body>
</html>
